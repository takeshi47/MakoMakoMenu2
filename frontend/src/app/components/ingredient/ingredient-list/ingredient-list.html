<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Ingredients</h2>
  </div>

  @if (ingredients && ingredients.length > 0) {
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Stock?</th>
            <th scope="col" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (ingredient of ingredients; track ingredient.id) {
            @if (isEdit(ingredient.id)) {
              <ng-container
                *ngTemplateOutlet="
                  formTemplate;
                  context: {
                    id: ingredient.id,
                  }
                "
              ></ng-container>
            } @else {
              <tr>
                <td>
                  {{ ingredient.name }}
                </td>
                <td>
                  @if (ingredient.isStock) {
                    <span class="badge bg-success">Yes</span>
                  } @else {
                    <span class="badge bg-secondary">No</span>
                  }
                </td>
                <td class="text-end">
                  <div class="btn-group">
                    <button class="btn btn-sm btn-outline-info" (click)="enableEdit(ingredient.id)">
                      編集
                    </button>
                    <button class="btn btn-sm btn-outline-danger">削除</button>
                  </div>
                </td>
              </tr>
            }
          }
          @if (isAdd) {
            <ng-container
              *ngTemplateOutlet="
                formTemplate;
                context: {
                  id: null,
                }
              "
            ></ng-container>
          }
          @if (!isAdd) {
            <tr>
              <td [colSpan]="3" class="text-end">
                <button class="btn btn-sm btn-secondary" (click)="enableAdd()">追加</button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    <div class="text-center p-5 border rounded bg-light">
      <p class="lead">No ingredients found.</p>
      <p>Get started by creating a new one!</p>
    </div>
  }
</div>

<ng-template #formTemplate let-id="id">
  <tr [formGroup]="form">
    <td>
      <input id="name_{{ id ?? '' }}" type="text" class="form-control" formControlName="name" />
    </td>
    <td>
      <div class="form-check">
        <input
          type="checkbox"
          class="form-check-input"
          formControlName="isStock"
          id="isStock_{{ id ?? '' }}"
        />
        <label for="isStock_{{ id ?? null }}" class="form-check-label">ストック有無</label>
      </div>
    </td>
    <td class="text-end">
      <div class="btn-group">
        <button class="btn btn-sm btn-outline-primary" type="submit" (click)="onSubmit(id)">
          保存
        </button>
        @if (id) {
          <button class="btn btn-sm btn-outline-secondary" (click)="cancelEditing(id)">戻る</button>
        } @else {
          <button class="btn btn-sm btn-outline-secondary" (click)="cancel()">戻る</button>
        }
      </div>
    </td>
  </tr>
</ng-template>
